(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f326d678","chunk-7859f8ee","chunk-7859f8ee"],{"129f":function(n,t){n.exports=Object.is||function(n,t){return n===t?0!==n||1/n===1/t:n!=n&&t!=t}},"231e":function(n,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return l})),a.d(t,"e",(function(){return C})),a.d(t,"d",(function(){return h})),a.d(t,"f",(function(){return f})),a.d(t,"c",(function(){return y})),a.d(t,"g",(function(){return v}));var e,i,o,s,c,d,r,m=a("8785"),u=a("5184"),p=Object(u["a"])(e||(e=Object(m["a"])(["\n  mutation createCompany($input: companyCreateInput!) {\n    createCompany(companyInput: $input) {\n      id\n      name\n      address\n      website\n      phones\n      socialMedias\n      owner {\n        id\n        user {\n          id\n          name\n        }\n      }\n      tags {\n        id\n        name\n        color\n        order\n      }\n      contacts {\n        id\n        name\n      }\n    }\n  }\n"]))),l=Object(u["a"])(i||(i=Object(m["a"])(["\n  mutation deletedCompanies($input: [DeleteCompanyInput!]!) {\n    deletedCompanies(companies: $input) {\n      id\n      name\n    }\n  }\n"]))),C=Object(u["a"])(o||(o=Object(m["a"])(["\n  mutation trashCompanies($input: [DeleteCompanyInput!]!) {\n    trashCompanies(companies: $input) {\n      id\n    }\n  }\n"]))),h=Object(u["a"])(s||(s=Object(m["a"])(["\n  mutation restoreCompanies($input: [DeleteCompanyInput!]!) {\n    restoreCompanies(companies: $input) {\n      id\n    }\n  }\n"]))),f=Object(u["a"])(c||(c=Object(m["a"])(["\n  mutation updateCompany($companyInput: companyUpdateInput!) {\n    updateCompany(companyInput: $companyInput) {\n      id\n      name\n      address\n      website\n      phones\n      customForms\n      socialMedias\n      tags {\n        id\n        name\n        color\n        order\n      }\n      owner {\n        id\n        user {\n          id\n          name\n        }\n      }\n      contacts {\n        id\n        name\n        owner {\n          id\n        }\n      }\n      deals {\n        id\n        title\n        value\n        status\n        contact {\n          id\n          name\n        }\n        company {\n          id\n          name\n        }\n        stage {\n          id\n        }\n        pipeline {\n          id\n          stages {\n            id\n          }\n        }\n        owner {\n          id\n        }\n      }\n    }\n  }\n"]))),y=Object(u["a"])(d||(d=Object(m["a"])(["\n  mutation FuseCompanies($input: CompaniesToFuse!) {\n    fuseCompanies(fuse: $input) {\n      id\n      name\n    }\n  }\n"]))),v=Object(u["a"])(r||(r=Object(m["a"])(["\n  mutation assignCompanies($companyListAssign: CompanyListAssign!) {\n    assignCompanies(companyListAssign: $companyListAssign)\n  }\n"])))},"2cff":function(n,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"f",(function(){return l})),a.d(t,"b",(function(){return C})),a.d(t,"e",(function(){return h})),a.d(t,"d",(function(){return f})),a.d(t,"c",(function(){return y})),a.d(t,"g",(function(){return v}));var e,i,o,s,c,d,r,m=a("8785"),u=a("5184"),p=Object(u["a"])(e||(e=Object(m["a"])(["\n  mutation CreateContact($input: contactCreateInput!) {\n    createContact(contactInput: $input) {\n      id\n      name\n      email\n      phones\n      isClient\n      socialMedias\n      birthday\n      owner {\n        id\n        user {\n          id\n          name\n          lastName\n        }\n      }\n      tags {\n        id\n        name\n        color\n        order\n      }\n      companies {\n        id\n        name\n      }\n      isClient\n    }\n  }\n"]))),l=Object(u["a"])(i||(i=Object(m["a"])(["\n  mutation updateContact($contactInput: contactUpdateInput) {\n    updateContact(contactInput: $contactInput) {\n      id\n      name\n      email\n      phones\n      isClient\n      socialMedias\n      birthday\n      customForms\n      owner {\n        id\n        user {\n          id\n          name\n        }\n      }\n      enterprise {\n        id\n        name\n      }\n      tags {\n        id\n        name\n        color\n        order\n      }\n      companies {\n        id\n        name\n        owner {\n          id\n        }\n      }\n      deals {\n        id\n        title\n        value\n        status\n        contact {\n          id\n          name\n        }\n        company {\n          id\n          name\n        }\n        stage {\n          id\n        }\n        pipeline {\n          id\n          stages {\n            id\n          }\n        }\n        owner {\n          id\n        }\n      }\n      createdAt\n    }\n  }\n"]))),C=Object(u["a"])(o||(o=Object(m["a"])(["\n  mutation deletedContacts($input: [DeleteContactInput!]!) {\n    deletedContacts(contacts: $input) {\n      id\n      name\n    }\n  }\n"]))),h=Object(u["a"])(s||(s=Object(m["a"])(["\n  mutation trashContacts($input: [DeleteContactInput!]!) {\n    trashContacts(contacts: $input) {\n      id\n      name\n    }\n  }\n"]))),f=Object(u["a"])(c||(c=Object(m["a"])(["\n  mutation restoreContacts($input: [DeleteContactInput!]!) {\n    restoreContacts(contacts: $input) {\n      id\n      name\n    }\n  }\n"]))),y=Object(u["a"])(d||(d=Object(m["a"])(["\n  mutation FuseContacts($input: ContactsToFuse!) {\n    fuseContacts(fuse: $input) {\n      id\n      name\n    }\n  }\n"]))),v=Object(u["a"])(r||(r=Object(m["a"])(["\n  mutation assignContacts($contactListAssign: ContactListAssign!) {\n    assignContacts(contactListAssign: $contactListAssign)\n  }\n"])))},"2faa":function(n,t,a){"use strict";a.d(t,"a",(function(){return i}));a("b0c0");var e=a("2cff"),i={data:function(){return{isLoadingUpdateContact:!1}},methods:{updateContact:function(n){var t=this,a=n.id,i=n.name,o=n.email,s=n.birthday,c=n.phones,d=n.isClient,r=n.socialMedias,m=n.customForm,u=n.company,p=n.owner,l=n.tags,C=n.deal;this.isLoadingUpdateContact=!0;var h={};h.id=a,i&&(h.name=i),o&&(h.email=o),s&&(h.birthday=s),c&&(h.phones=c),!0!==d&&!1!==d||(h.isClient=d),r&&(h.socialMedias=r),m&&(h.customForm=m),u&&(h.company=u),p&&(h.owner=p),l&&(h.tags=l),C&&(h.deal=C),this.$apollo.mutate({mutation:e["f"],variables:{contactInput:h}}).then((function(n){var a=n.data.updateContact;t.$emit("updateItem",a),t.$emit("updateHistory"),t.isLoadingUpdateContact=!1})).catch((function(){t.isLoadingUpdateContact=!1;var n="No se pudo actualizar el contacto, intente de nuevo o contacte a soporte";t.modalHandlerError({isOpen:!0,error:n})}))}}}},3439:function(n,t,a){},"50e6":function(n,t,a){"use strict";a.r(t);var e=function(){var n=this,t=n.$createElement,a=n._self._c||t;return a("v-card",{attrs:{tile:"",flat:""}},[a("v-divider"),a("v-card-title",{staticClass:"companies-title py-1"},[a("v-icon",{staticClass:"mr-4"},[n._v("mdi-domain")]),n._v(" Empresas "),a("v-spacer"),a("v-menu",{staticClass:"mt-2",attrs:{"close-on-content-click":!1},scopedSlots:n._u([{key:"activator",fn:function(t){var e=t.on;return[a("v-btn",n._g({directives:[{name:"show",rawName:"v-show",value:(n.canEditContact||n.canEditContactOthers)&&!n.item.isDelete,expression:"(canEditContact || canEditContactOthers) && !item.isDelete"}],attrs:{icon:""},on:{click:function(t){n.isShowAddCompany=!n.isShowAddCompany}}},e),[a("v-icon",[n._v("mdi-plus")])],1)]}}]),model:{value:n.isShowAddCompany,callback:function(t){n.isShowAddCompany=t},expression:"isShowAddCompany"}},[a("v-card",{staticClass:"pa-4",attrs:{width:"18em"}},[a("v-form",{ref:"formCompany"},[a("FieldSelectCompanySimple",{attrs:{inputProps:{class:"no-icon full-width",isDense:!0},resetHandler:n.isShowAddCompany},on:{outData:n.updateCompany,deleteData:n.deleteCompany}})],1),a("div",{staticClass:"d-flex justify-center pt-2 ml-2"},[a("v-btn",{staticClass:"mr-2",staticStyle:{width:"45%"},attrs:{outlined:"",color:"primary",small:""},on:{click:n.cancel}},[n._v(" Cancelar ")]),!n.canEditContact&&!n.canEditContactOthers||n.item.isDelete?n._e():a("v-btn",{staticStyle:{width:"45%"},attrs:{color:"secondary",small:"",loading:n.isLoading,disabled:n.disabledAddButton},on:{click:n.addCompany}},[n._v(" Guardar ")])],1)],1)],1)],1),a("v-divider"),a("v-card-text",{staticClass:"pa-0"},[a("v-card",{staticClass:"companies-container",attrs:{flat:"","max-height":"20em"}},[0===n.companiesSelected.length?a("div",{staticClass:"pa-10"},[a("span",[n._v(" No tiene empresas ")])]):n._l(n.listCompanies,(function(t,e){return[a("v-list-item",{key:t.id,staticClass:"Company",attrs:{outlined:""}},[a("v-list-item-content",[a("v-list-item-title",{staticClass:"Company__title"},[[a("div",{staticClass:"Company__box",on:{click:function(a){return n.goCompany(t.id)}}},[a("v-icon",{staticClass:"pb-1"},[n._v("mdi-domain")]),a("span",{staticClass:"Company__box_name"},[n._v(" "+n._s(t.name)+" ")])],1)]],2)],1),a("v-list-item-action",{staticClass:"Company__edit mt-4"},[a("v-tooltip",{attrs:{bottom:""},scopedSlots:n._u([{key:"activator",fn:function(e){var i=e.on,o=e.attrs;return[a("v-btn",n._g(n._b({directives:[{name:"show",rawName:"v-show",value:n.canEditContact||n.canEditContactOthers,expression:"canEditContact || canEditContactOthers"}],staticClass:"mr-2",attrs:{"x-small":"",loading:n.isLoadingRemove,color:"grey",outlined:""},on:{click:function(a){return a.stopPropagation(),n.disconnectCompany(t.id)}}},"v-btn",o,!1),i),[a("v-icon",{attrs:{small:""}},[n._v("mdi-connection")])],1)]}}],null,!0)},[a("span",[n._v("Desvincular")])]),a("v-menu",{attrs:{"close-on-content-click":!1},scopedSlots:n._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-tooltip",{attrs:{bottom:""},scopedSlots:n._u([{key:"activator",fn:function(e){var o=e.on;return[a("v-btn",n._g({directives:[{name:"show",rawName:"v-show",value:(n.canEditContact||n.canEditContactOthers)&&(n.canEditCompany(t.owner)||n.canEditCompanyOthers(t.owner)),expression:"\n                        (canEditContact || canEditContactOthers) &&\n                          (canEditCompany(company.owner) ||\n                            canEditCompanyOthers(company.owner))\n                      "}],attrs:{color:"secondary","x-small":""},on:{click:function(n){n.stopPropagation(),t.edit=!0}}},Object.assign({},i,o)),[a("v-icon",{attrs:{small:"",color:"white"}},[n._v("mdi-pencil")])],1)]}}],null,!0)},[a("span",[n._v("Cambiar nombre")])])]}}],null,!0),model:{value:t.edit,callback:function(a){n.$set(t,"edit",a)},expression:"company.edit"}},[a("v-card",{staticClass:"pa-4",attrs:{width:"18em"}},[a("v-form",{ref:"form-"+e,refInFor:!0,attrs:{"lazy-validation":""},model:{value:n.isValidateFormName,callback:function(t){n.isValidateFormName=t},expression:"isValidateFormName"}},[a("v-text-field",{attrs:{label:"Nombre",dense:"",outlined:"","hide-details":"auto",maxlength:"50",rules:n.rules.general},model:{value:t.name,callback:function(a){n.$set(t,"name",a)},expression:"company.name"}}),a("div",{staticClass:"d-flex justify-center mt-1"},[a("v-btn",{staticClass:"mr-2",staticStyle:{width:"45%"},attrs:{"x-small":"",color:"primary",outlined:""},on:{click:function(a){return n.cancelEdit(t.id)}}},[n._v(" Cancelar ")]),(n.canEditContact||n.canEditContactOthers)&&(n.canEditCompany(t.owner)||n.canEditCompanyOthers(t.owner))?a("v-btn",{staticStyle:{width:"45%"},attrs:{"x-small":"",color:"secondary",loading:n.isLoadingChangeName},on:{click:function(a){return n.updateName({id:t.id,name:t.name,idx:e})}}},[n._v(" Guardar ")]):n._e()],1)],1)],1)],1)],1)],1)]}))],2),a("BaseModalError",{attrs:{modalHandler:n.modalError},on:{close:n.modalHandlerError}})],1)],1)},i=[],o=(a("d3b7"),a("3ca3"),a("ddb0"),a("ac1f"),a("841c"),a("b0c0"),a("d81d"),a("b64b"),a("c740"),a("a434"),a("7db0"),a("4b58")),s=a("9685"),c=a("891c"),d=a("ee2e"),r=a("231e"),m=a("f82a"),u=a("2faa"),p=a("1e6d"),l=a("e815"),C={name:"ListCompanies",components:{FieldSelectCompanySimple:function(){return a.e("chunk-7a875db0").then(a.bind(null,"8be5"))}},mixins:[m["a"],u["a"],p["a"]],props:{item:{type:Object,required:!0},itemId:{type:String,default:"",required:!0},typeItem:{type:String,required:!0,default:"CONTACT"},ownerId:{type:String,default:""},companiesSelected:{type:Array,default:function(){return[]}}},data:function(){return{UPDATE:c["r"],UPDATE_OTHERS:c["s"],PERMISSIONS_CONTACTS:d["e"],PERMISSIONS_COMPANIES:d["d"],search:"",company:"",companies:{},isLoading:!1,listCompanies:[],isNewCompany:!1,isLoadingRemove:!1,isShowAddCompany:!1,isValidateFormName:!0,isLoadingChangeName:!1,companyNew:{id:"",name:""},companyRules:[function(n){return!!n||"Debes seleccionar o crear una empresa"}],userCurrent:{}}},created:function(){this.listCompanies=this.formatListCompanies(this.companiesSelected)},watch:{companiesSelected:{handler:function(n){this.listCompanies=this.formatListCompanies(n)},deep:!0},company:function(n){n&&n.id?(this.isNewCompany=!1,this.companyNew={id:n.id,name:""}):n?(this.isNewCompany=!0,this.companyNew={id:"",name:n}):this.companyNew={id:"",name:""}},isLoadingUpdateContact:function(n){n||(this.isLoading=!1,this.company="",this.isShowAddCompany&&this.$refs.formCompany.reset(),this.isShowAddCompany=!1,this.isLoadingRemove=!1,this.companyNew={id:"",name:""})}},computed:{canEditContact:function(){return"CONTACT"===this.typeItem&&s["a"].can(c["r"],Object(o["b"])(d["e"],{authorId:this.ownerId||""}))},canEditContactOthers:function(){return"CONTACT"===this.typeItem&&(this.canEditContact?s["a"].can(c["s"],Object(o["b"])(d["e"],{authorId:this.ownerId||""})):s["a"].can(c["s"],d["e"])&&!s["a"].can(c["s"],Object(o["b"])(d["e"],{authorId:this.ownerId||""})))},menuProps:function(){return this.search?{}:{value:!1}},disabledAddButton:function(){return!this.companyNew.id&&!this.companyNew.name}},methods:{canEditCompany:function(n){return s["a"].can(c["r"],Object(o["b"])(d["d"],{authorId:n.id||""}))},canEditCompanyOthers:function(n){return this.canEditCompany(n)?s["a"].can(c["r"],Object(o["b"])(d["d"],{authorId:n.id||""})):s["a"].can(c["s"],d["d"])&&!s["a"].can(c["s"],Object(o["b"])(d["d"],{authorId:n.id||""}))},updateCompany:function(n,t){this.companyNew=t},deleteCompany:function(){this.companyNew={id:"",name:""}},formatListCompanies:function(n){return n.map((function(n){return{id:n.id,name:n.name,edit:!1,owner:n.owner}}))},goCompany:function(n){"company"!==this.$router.name&&this.$router.push({name:"company",params:{id:n}},(function(){}))},cancel:function(){this.company="",this.companyNew={id:"",name:""},this.isShowAddCompany=!1},formatCompanies:function(n){return n.map((function(n){return{id:n.id}}))},addCompany:function(){this.canEditContact&&0!==Object.keys(this.companyNew).length&&(this.isLoading=!0,this.updateContact({id:this.itemId,company:this.companyNew}))},disconnectCompany:function(n){if(this.canEditContact){this.isLoadingRemove=!0;var t=JSON.parse(JSON.stringify(this.companiesSelected)),a=this.formatCompanies(t),e=a.findIndex((function(t){return t.id===n}));a.splice(e,1),this.updateContact({id:this.itemId,company:{disconnect:{id:n}}})}},updateName:function(n){var t=this,a=n.id,e=n.name,i=n.idx;(this.canEditCompany||this.canEditCompanyOthers)&&(this.$refs["form-".concat(i)][0].validate(),this.isValidateFormName&&(this.isLoadingChangeName=!0,this.$apollo.mutate({mutation:r["f"],variables:{companyInput:{id:a,name:e}}}).then((function(n){var a=n.data.updateCompany;t.$emit("updateContactCompany",a,i),t.isLoadingChangeName=!1,t.isValidateFormName=!1})).catch((function(){t.isLoadingChangeName=!1,t.isValidateFormName=!1;var n="No se pudo cambiar el nombre de la empresa, intente de nuevo o contacte a soporte";t.modalHandlerError({isOpen:!0,error:n})}))))},getIndexField:function(n){return this.listCompanies.findIndex((function(t){return t.id===n}))},text:function(n){return"".concat(n.name)},cancelEdit:function(n){var t=this.getIndexField(n);this.listCompanies[t].edit=!1;var a=this.companiesSelected.find((function(t){return t.id===n})).name;this.listCompanies[t].name=a}},apollo:{userCurrent:{query:l["k"]}}},h=C,f=(a("f087"),a("0c7c")),y=a("6544"),v=a.n(y),b=a("8336"),w=a("b0af"),g=a("99d9"),O=a("ce7e"),I=a("4bd4"),E=a("132d"),N=a("da13"),S=a("1800"),j=a("5d23"),$=a("e449"),_=a("2fa4"),x=a("8654"),L=a("3a2f"),A=Object(f["a"])(h,e,i,!1,null,"09ac20d6",null);t["default"]=A.exports;v()(A,{VBtn:b["a"],VCard:w["a"],VCardText:g["c"],VCardTitle:g["d"],VDivider:O["a"],VForm:I["a"],VIcon:E["a"],VListItem:N["a"],VListItemAction:S["a"],VListItemContent:j["a"],VListItemTitle:j["c"],VMenu:$["a"],VSpacer:_["a"],VTextField:x["a"],VTooltip:L["a"]})},"841c":function(n,t,a){"use strict";var e=a("d784"),i=a("825a"),o=a("1d80"),s=a("129f"),c=a("14c3");e("search",(function(n,t,a){return[function(t){var a=o(this),e=void 0==t?void 0:t[n];return void 0!==e?e.call(t,a):new RegExp(t)[n](String(a))},function(n){var e=a(t,this,n);if(e.done)return e.value;var o=i(this),d=String(n),r=o.lastIndex;s(r,0)||(o.lastIndex=0);var m=c(o,d);return s(o.lastIndex,r)||(o.lastIndex=r),null===m?-1:m.index}]}))},f087:function(n,t,a){"use strict";a("3439")}}]);
//# sourceMappingURL=chunk-f326d678.cb70a02d.js.map