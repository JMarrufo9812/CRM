(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b667c2e"],{"5e30":function(e,t,r){"use strict";r("df63")},b7a4:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-card",{staticClass:"mb-6",attrs:{tile:"",outlined:"",width:"35em",height:"25em"}},[r("div",{staticClass:"d-flex justify-space-between align-center primary py-4 px-8"},[r("span",{staticClass:"white--text title-eneterprise-settings"},[e._v(" Mis cuentas ")]),r("v-btn",{attrs:{small:"",color:"secondary",dark:"",fab:"",depressed:""},on:{click:function(t){e.isOpenModal=!0}}},[r("v-icon",[e._v("mdi-plus")])],1)],1),r("div",{staticClass:"header-enterprises py-4 pl-8"},[e._v(" Nombre de la empresa ")]),e.isLoadingChangeAccount?r("div",{staticClass:"d-flex justify-center"},[r("v-progress-circular",{attrs:{size:50,indeterminate:"",color:"primary"}})],1):e._e(),e.error?r("v-alert",{attrs:{type:"error"}},[e._v(" Ha ocurrido un error interno ")]):e._e(),e.error||e.isLoadingChangeAccount?e._e():r("v-card",{staticClass:"scroll",attrs:{flat:"",height:"70%"}},e._l(e.userCurrent.enterprises,(function(t){return r("v-card",{key:t.id,staticClass:"d-flex justify-space-between enterprise-box align-center pl-8",class:{"enterprise-selected":t.id===e.userCurrent.enterprise.id},attrs:{flat:"",height:"6em"},on:{click:function(r){return e.goEnterprise(t)}}},[r("span",{staticClass:"enterprise-name"},[e._v(" "+e._s(t.name)+" ")]),r("div",[t.userEnterpriseId===e.userCurrent.defaultEnterprise?r("v-chip",{staticClass:"ma-2",attrs:{color:"green",small:"","text-color":"white"}},[e._v(" Principal ")]):e._e(),"PENDING"===t.isActive?r("v-chip",{staticClass:"ma-2",attrs:{color:"warning",small:"","text-color":"white"}},[e._v(" Invitación pendiente ")]):e._e(),r("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(s){var i=s.on,n=s.attrs;return[r("v-btn",e._g(e._b({staticClass:"mr-4",attrs:{disabled:"PENDING"!==t.isActive&&t.userEnterpriseId===e.userCurrent.defaultEnterprise,icon:""}},"v-btn",n,!1),i),[r("v-icon",[e._v("mdi-dots-vertical")])],1)]}}],null,!0)},[r("v-list",[t.userEnterpriseId!==e.userCurrent.defaultEnterprise&&"PENDING"!==t.isActive?r("v-list-item",{attrs:{dense:""},on:{click:function(r){return e.changeDefaultEnterprise(t.id,t.userEnterpriseId)}}},[r("v-list-item-title",[e._v(" Marcar como principal ")])],1):e._e(),"PENDING"===t.isActive?r("v-list-item",{attrs:{dense:""},on:{click:function(r){return e.confirmEnterprise(t)}}},[r("v-list-item-title",[e._v(" Aceptar invitacion ")])],1):e._e()],1)],1)],1)])})),1)],1),r("v-card",{staticClass:"d-flex justify-center align-center",attrs:{tile:"",outlined:"",height:"4em",width:"35em"}},[r("p",{staticClass:"ma-0 text-note-enterprise"},[r("span",{staticClass:"secondary--text"},[e._v(" Nota: ")]),r("span",[e._v(" La cuenta ")]),r("b",{staticClass:"secondary--text"},[e._v("principal")]),e._v(" es la que se abre cuando inicias sesión. ")])]),r("EnterpriseModal",{attrs:{isOpenModal:e.isOpenModal},on:{"update:isOpenModal":function(t){e.isOpenModal=t},"update:is-open-modal":function(t){e.isOpenModal=t}}}),r("BaseModalAlert",{attrs:{modalHandler:e.modalAlert,cancel:!1},on:{confirm:e.modalHandlerAlert}}),r("BaseModalError",{attrs:{modalHandler:e.modalError},on:{close:e.modalHandlerError}})],1)},i=[],n=r("1da1"),a=(r("96cf"),r("d81d"),r("159b"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-dialog",{attrs:{persistent:"","max-width":"850"},model:{value:e.isOpenModal,callback:function(t){e.isOpenModal=t},expression:"isOpenModal"}},[r("v-stepper",{model:{value:e.step,callback:function(t){e.step=t},expression:"step"}},[r("v-stepper-header",[r("v-stepper-step",{attrs:{complete:e.isCompletedRegister,editable:e.isCompletedRegister,step:"1"}},[e._v(" Registro de empresa ")]),r("v-divider"),r("v-stepper-step",{attrs:{complete:e.isCompletedQuestions,editable:e.isCompletedQuestions,step:"2"}},[e._v(" Preguntas ")])],1),r("v-stepper-items",[r("v-stepper-content",{attrs:{step:"1"}},[r("v-form",{ref:"formEnterprise",model:{value:e.isValidateEnterprise,callback:function(t){e.isValidateEnterprise=t},expression:"isValidateEnterprise"}},[r("v-container",[r("v-row",[r("v-col",{attrs:{cols:"12",sm:"6"}},[r("v-text-field",{staticClass:"required",attrs:{rules:e.rules.general,outlined:"",label:"Nombre de tu empresa",required:"",counter:"50",maxlength:"50",loading:e.isLoadingChecking,error:e.existEnterprise,"error-messages":e.errorMessages,"hide-details":"auto"},on:{input:function(t){return e.checkEnterprise(e.enterprise.name)}},model:{value:e.enterprise.name,callback:function(t){e.$set(e.enterprise,"name",t)},expression:"enterprise.name"}})],1),r("v-col",{attrs:{cols:"12",sm:"6"}},[r("v-select",{staticClass:"required",attrs:{rules:e.rules.select,outlined:"",label:"Industria",items:e.industries,"item-text":function(e){return e.name},"item-value":function(e){return e.id},required:"","hide-details":"auto"},model:{value:e.enterprise.industry.id,callback:function(t){e.$set(e.enterprise.industry,"id",t)},expression:"enterprise.industry.id"}})],1),r("v-col",{attrs:{cols:"12",sm:"12"}},[r("v-text-field",{staticClass:"required",attrs:{rules:e.rules.address,outlined:"",label:"Dirección de empresa",required:"",counter:"100",maxlength:"100","hide-details":"auto"},model:{value:e.enterprise.address,callback:function(t){e.$set(e.enterprise,"address",t)},expression:"enterprise.address"}})],1),e._l(e.enterprise.phones,(function(t,s){return r("v-col",{key:s,attrs:{cols:"12",sm:"6"}},[r("transition",{attrs:{name:"fade"}},[r("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"##########",expression:"'##########'"}],staticClass:"required",attrs:{rules:e.rules.phoneNumber,outlined:"",label:e.enterprise.phones.length>1?"Teléfono "+(s+1):"Teléfono",required:"",type:"tel",counter:"10",autofocus:e.enterprise.phones.length>1,"hide-details":"auto"},model:{value:t.number,callback:function(r){e.$set(t,"number",r)},expression:"phone.number"}},[r("template",{slot:"append-outer"},0===s?[r("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var s=t.on,i=t.attrs;return[r("v-icon",e._g(e._b({attrs:{color:"success",disabled:e.enterprise.phones.length>2},on:{click:e.addPhone}},"v-icon",i,!1),s),[e._v(" mdi-phone-plus ")])]}}],null,!0)},[r("span",[e._v("Agregar otro teléfono")])])]:[r("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,n=t.attrs;return[r("v-icon",e._g(e._b({attrs:{color:"primary"},on:{click:function(t){return e.deletePhone(s)}}},"v-icon",n,!1),i),[e._v(" mdi-minus-circle ")])]}}],null,!0)},[r("span",[e._v("Quitar teléfono")])])],1)],2)],1)],1)})),r("v-col",{attrs:{cols:"12",sm:"6"}},[r("v-text-field",{staticClass:"required",attrs:{rules:e.rules.general,outlined:"",label:"Puesto en la empresa",required:"","hide-details":"auto",maxlength:"25"},model:{value:e.jobTitle,callback:function(t){e.jobTitle=t},expression:"jobTitle"}})],1),r("v-col",{attrs:{cols:"12"}},[r("v-text-field",{attrs:{rules:e.rules.website,outlined:"",label:"Página web",hint:"www.example.com","persistent-hint":"","hide-details":"auto",maxlength:"50"},model:{value:e.enterprise.website,callback:function(t){e.$set(e.enterprise,"website",t)},expression:"enterprise.website"}})],1)],2)],1)],1),r("div",{staticClass:"d-flex justify-space-between pt-5"},[r("v-btn",{attrs:{color:"primary",outlined:""},on:{click:e.cancelModalRegister}},[e._v(" Cancelar ")]),r("v-btn",{attrs:{color:"secondary"},on:{click:function(t){return e.stepNext(2)}}},[e._v(" Continuar "),r("v-icon",[e._v("mdi-page-last")])],1)],1)],1),r("v-stepper-content",{attrs:{step:"2"}},[r("v-form",{ref:"formQuestions",model:{value:e.isValidateQuestion,callback:function(t){e.isValidateQuestion=t},expression:"isValidateQuestion"}},[r("v-container",[r("v-row",e._l(e.questions,(function(t,s){return r("v-col",{key:t.id,attrs:{cols:"12"}},[r("v-select",{staticClass:"required",attrs:{label:t.question,rules:e.rules.select,outlined:"",items:t.options.map((function(e){return{question:t.question,option:e}})),"item-text":"option","return-object":"","hide-details":"auto"},model:{value:e.enterprise.answers[s],callback:function(t){e.$set(e.enterprise.answers,s,t)},expression:"enterprise.answers[index]"}})],1)})),1)],1)],1),r("div",{staticClass:"d-flex justify-space-between pt-5"},[r("v-btn",{attrs:{color:"primary",outlined:""},on:{click:e.cancelModalRegister}},[e._v(" Cancelar ")]),r("v-btn",{attrs:{color:"secondary"},on:{click:function(t){return e.save()}}},[e.isLoading?r("v-progress-circular",{attrs:{indeterminate:"",color:"white"}}):r("span",{staticClass:"mr-3"},[e._v("Crear empresa")])],1)],1)],1)],1)],1),r("EnterpriseModalConfirm",{attrs:{dialog:e.isConfirmDialog},on:{"update:dialog":function(t){e.isConfirmDialog=t},confirm:e.cancel}}),r("BaseModalError",{attrs:{modalHandler:e.modalError},on:{close:e.modalHandlerError}})],1)}),o=[],l=r("5530"),c=(r("a9e3"),r("a434"),r("b0c0"),r("e815")),u=r("ef6b"),d=r("659f"),p=r("c126"),m=r("f82a"),f=r("36ea"),v=r("1e6d"),h=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-dialog",{attrs:{persistent:"",width:"500"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",{attrs:{width:"500"}},[r("div",{staticClass:"d-flex justify-center pt-6"},[r("v-icon",{attrs:{"x-large":"",color:"warning"}},[e._v(" mdi-alert ")])],1),r("v-card-title",{staticClass:"pt-1 pb-0 d-flex justify-center"},[r("span",{staticClass:"title-modal"},[e._v(" Atención ")])]),r("v-card-text",{staticClass:"pt-0",attrs:{align:"center"}},[r("v-icon",{staticClass:"white--text mr-1"},[e._v("mdi-alert")]),r("p",{staticClass:"text-center mb-0"},[e._v(" Se perderán los datos del registro. ")])],1),r("v-card-actions",[r("v-btn",{attrs:{tile:"",outlined:"",text:""},on:{click:e.close}},[e._v(" No, regresar al registro ")]),r("v-spacer"),r("v-btn",{attrs:{color:"error"},on:{click:e.confirm}},[e._v(" Sí, cancelar ")])],1)],1)],1)},g=[],b={name:"EnterpriseModalConfirm",props:{dialog:{type:Boolean}},methods:{close:function(){this.$emit("update:dialog",!1)},confirm:function(){this.$emit("update:dialog",!1),this.$emit("confirm",!0)}}},C=b,E=r("0c7c"),x=r("6544"),_=r.n(x),y=r("8336"),w=r("b0af"),V=r("99d9"),k=r("169a"),A=r("132d"),I=r("2fa4"),$=Object(E["a"])(C,h,g,!1,null,"d263a7e0",null),M=$.exports;_()($,{VBtn:y["a"],VCard:w["a"],VCardActions:V["a"],VCardText:V["c"],VCardTitle:V["d"],VDialog:k["a"],VIcon:A["a"],VSpacer:I["a"]});var O={name:"EnterpriseModal",components:{EnterpriseModalConfirm:M},mixins:[m["a"],f["a"],v["a"]],props:{isOpenModal:{required:!0,type:Boolean}},data:function(){return{userCurren:{},show:!1,step:1,isLoading:!1,industries:[],questions:[],enterprise:{name:"",industry:{id:""},address:"",website:"",phones:[{number:""}],answers:[]},jobTitle:"",isValidateEnterprise:!0,isValidateQuestion:!0,isCompletedRegister:!1,isCompletedQuestions:!1,isConfirmDialog:!1}},computed:{errorMessages:function(){return this.existEnterprise?["La empresa ya existe, intenta con otro nombre"]:[]}},methods:{stepNext:function(e){if(!this.existEnterprise){var t=Number(this.step);1===t&&this.$refs.formEnterprise.validate()?(this.isCompletedRegister=!0,this.step=e):2===t&&this.$refs.formQuestions.validate()&&(this.isCompletedQuestions=!0,this.step=e)}},addPhone:function(){this.enterprise.phones.push({number:""})},deletePhone:function(e){this.enterprise.phones.splice(e,1)},closeModal:function(){this.$emit("update:isOpenModal",!1)},cancel:function(){this.closeModal(),this.resetAllValidation(),this.resetAll()},cancelModalRegister:function(){this.hasDataFormEnterprise()?this.isConfirmDialog=!0:this.cancel()},hasDataFormEnterprise:function(){return!!(this.enterprise.name||this.enterprise.industry.id||this.enterprise.address||this.enterprise.phones[0].number||this.jobTitle||this.enterprise.website)},save:function(){this.validateAll(),this.isValidateEnterprise&&this.isValidateQuestion&&this.create()},create:function(){var e=this;this.isLoading=!0;var t=JSON.parse(JSON.stringify(this.enterprise));this.$apollo.mutate({mutation:p["a"],variables:{enterpriseInput:{enterprise:{name:t.name,industry:{id:t.industry.id},address:t.address,website:t.website,phones:t.phones},jobTitle:this.jobTitle,answers:t.answers}},update:function(e,t){var r=t.data.createEnterprise,s=e.readQuery({query:c["k"]});s.userCurrent.enterprises.push(Object(l["a"])(Object(l["a"])({},r.enterprise),{},{userEnterpriseId:r.id})),e.writeQuery({query:c["k"],data:s})},optimisticResponse:{__typename:"Mutation",createEnterprise:{id:-1,__typename:"UserEnterprise",enterprise:{__typename:"Enterprise",id:-1,name:t.name}}}}).then((function(){e.isLoading=!1,e.cancel()})).catch((function(){e.isLoading=!1;var t="No se pudo crear la empresa, intente de nuevo o contacte a soporte";e.modalHandlerError({isOpen:!0,error:t})}))},validateAll:function(){this.$refs.formEnterprise.validate(),this.$refs.formQuestions.validate()},resetAll:function(){this.$refs.formEnterprise.reset(),this.$refs.formQuestions.reset(),this.selected=null,this.jobTitle="",this.step=1,this.isCompletedRegister=!1,this.isCompletedQuestions=!1,this.enterprise.phones=[{number:""}]},resetAllValidation:function(){this.$refs.formEnterprise.resetValidation(),this.$refs.formQuestions.resetValidation()}},apollo:{industries:{query:u["a"]},questions:{query:d["a"]}}},j=O,q=r("62ad"),L=r("a523"),D=r("ce7e"),N=r("4bd4"),Q=r("490a"),P=r("0fd9"),T=r("b974"),S=r("7e85"),R=r("e516"),H=r("9c54"),B=r("56a4"),F=r("8654"),G=r("3a2f"),J=Object(E["a"])(j,a,o,!1,null,"44bec4d7",null),U=J.exports;_()(J,{VBtn:y["a"],VCol:q["a"],VContainer:L["a"],VDialog:k["a"],VDivider:D["a"],VForm:N["a"],VIcon:A["a"],VProgressCircular:Q["a"],VRow:P["a"],VSelect:T["a"],VStepper:S["a"],VStepperContent:R["a"],VStepperHeader:H["a"],VStepperItems:H["b"],VStepperStep:B["a"],VTextField:F["a"],VTooltip:G["a"]});var z=r("44da"),K=r("f0ff"),W={name:"Enterprises",components:{EnterpriseModal:U},mixins:[v["a"]],data:function(){return{isLoadingDefault:!1,isLoadingChangeAccount:!1,userCurrent:{},isOpenModal:!1,error:!1,headers:[{text:"Nombre de la empresa",align:"start",sortable:!1,value:"name"},{text:"",align:"end",sortable:!1,value:"action"}],footerProps:{itemsPerPageOptions:[5,10,25,{text:"Todos",value:-1}],itemsPerPageText:"Filas por página"}}},methods:{confirmEnterprise:function(e){var t=this,r=e.id;this.isLoadingChangeAccount=!0,this.$apollo.mutate({mutation:K["a"],variables:{enterpriseId:r}}).then((function(e){var r=e.data.confirmEnterprise;t.userCurrent.enterprises=t.userCurrent.enterprises.map((function(e){return e.id===r&&(e.isActive="ACTIVE"),e})),t.$apollo.queries.userCurrent.refetch(),t.isLoadingChangeAccount=!1})).catch((function(){t.isLoadingChangeAccount=!1;var e="No se ha podido aceptar la  invitación  intente de nuevo o contacte a soporte";t.modalHandlerError({isOpen:!0,error:e})}))},rowClass:function(){var e="rowItem";return e},changeDefaultEnterprise:function(e,t){var r=this;this.isLoadingDefault=!0,this.$apollo.mutate({mutation:p["c"],variables:{enterpriseId:e},update:function(e,r){var s=r.data.updateEnterpriseDefault;if(s){var i=e.readQuery({query:c["k"]});i.userCurrent.defaultEnterprise=t,e.writeQuery({query:c["k"],data:i})}}}).then((function(){r.isLoadingDefault=!1})).catch((function(){r.isLoadingDefault=!1}))},goEnterprise:function(e){var t=this,r=e.id,s=e.isActive;"PENDING"!==s?r!==this.userCurrent.enterprise.id&&(this.isLoadingChangeAccount=!0,this.$apollo.mutate({mutation:K["d"],variables:{id:r}}).then(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(r){var s,i,n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=r.data.loginChangeUserEnterprise,i=s.token,n=s.userEnterprise.role.type,localStorage.setItem(z["a"],i),e.next=4,t.$apollo.provider.defaultClient.resetStore();case 4:if(a=e.sent,!a){e.next=9;break}if("ADMIN"!==n){e.next=8;break}return e.abrupt("return",t.$router.push({name:"dashboards"},(function(){t.isLoadingChangeAccount=!1})));case 8:return e.abrupt("return",t.$router.push("/",(function(){t.isLoadingChangeAccount=!1})));case 9:return t.isLoadingChangeAccount=!1,e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){var r=e.graphQLErrors;r.forEach((function(e){401===e.statusCode&&console.log("No autorizado - Cerrar sesión")})),t.isError=!0,t.isLoadingChangeAccount=!1}))):this.modalHandlerAlert({isOpen:!0,isLoading:!1,message:{title:"Acepta la invitación para ir a la empresa",text:"Es necesario que aceptes la invitación para que puedas acceder a la empresa hazlo desde este apartado o entrando a tu correo y aceptando la invitación"},info:{}})}},apollo:{userCurrent:{query:c["k"]}}},X=W,Y=(r("5e30"),r("0798")),Z=r("cc20"),ee=r("8860"),te=r("da13"),re=r("5d23"),se=r("e449"),ie=Object(E["a"])(X,s,i,!1,null,"6f687f99",null);t["default"]=ie.exports;_()(ie,{VAlert:Y["a"],VBtn:y["a"],VCard:w["a"],VChip:Z["a"],VIcon:A["a"],VList:ee["a"],VListItem:te["a"],VListItemTitle:re["c"],VMenu:se["a"],VProgressCircular:Q["a"]})},c126:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u}));var s,i,n,a=r("8785"),o=r("5184"),l=Object(o["a"])(s||(s=Object(a["a"])(["\n  mutation createEnterprise($enterpriseInput: enterpriseOtherCreateInput!) {\n    createEnterprise(enterpriseInput: $enterpriseInput) {\n      id\n      enterprise {\n        id\n        name\n      }\n    }\n  }\n"]))),c=Object(o["a"])(i||(i=Object(a["a"])(["\n  mutation UpdateEnterprise($input: enterpriseUpdateInput!) {\n    updateEnterprise(enterpriseInput: $input) {\n      id\n      name\n    }\n  }\n"]))),u=Object(o["a"])(n||(n=Object(a["a"])(["\n  mutation updateEnterpriseDefault($enterpriseId: ID!) {\n    updateEnterpriseDefault(enterpriseId: $enterpriseId)\n  }\n"])))},df63:function(e,t,r){}}]);
//# sourceMappingURL=chunk-2b667c2e.981d040b.js.map