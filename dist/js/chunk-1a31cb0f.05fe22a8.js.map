{"version":3,"sources":["webpack:///./src/components/deals/MenuChangePipeline.vue?301a","webpack:///./src/components/deals/MenuChangePipeline.vue?4b7d","webpack:///src/components/deals/MenuChangePipeline.vue","webpack:///./src/components/deals/MenuChangePipeline.vue?a6da","webpack:///./src/components/deals/MenuChangePipeline.vue?cc65"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","canEdit","canEditOthers","deal","isDelete","scopedSlots","_u","key","fn","ref","on","_g","_b","class","normalCursor","_v","_s","pipeline","name","_e","model","value","callback","$$v","menu","expression","staticClass","pipelines","pipelineSelected","_l","stage","index","done","$event","selectStage","cancel","viewStages","isLoading","outData","staticRenderFns","props","type","Object","required","Boolean","ownerId","String","data","stageSelected","PERMISSIONS_DEALS","UPDATE","UPDATE_OTHERS","watch","JSON","parse","stringify","stages","computed","ability","methods","pipelineId","id","stageId","$emit","input","map","apollo","query","fetchPolicy","component","VBtn","VCard","VCardActions","VCardText","VCardTitle","VDivider","VIcon","VMenu","VSelect","VTooltip"],"mappings":"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","file":"js/chunk-1a31cb0f.05fe22a8.js","sourcesContent":["export * from \"-!../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuChangePipeline.vue?vue&type=style&index=0&id=6e5c3426&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-menu',{attrs:{\"bottom\":\"\",\"offset-y\":\"\",\"max-width\":\"300\",\"nudge-bottom\":\"10\",\"close-on-content-click\":false,\"disabled\":!((_vm.canEdit || _vm.canEditOthers) && !_vm.deal.isDelete)},scopedSlots:_vm._u([{key:\"activator\",fn:function(ref){\nvar on = ref.on;\nvar attrs = ref.attrs;\nreturn [_c('span',_vm._g(_vm._b({},'span',attrs,false),on),[_c('v-btn',{class:{\n          normalCursor: !((_vm.canEdit || _vm.canEditOthers) && !_vm.deal.isDelete),\n        },attrs:{\"outlined\":\"\"}},[_vm._v(\" \"+_vm._s(_vm.deal.pipeline ? _vm.deal.pipeline.name : '')+\" \"),((_vm.canEdit || _vm.canEditOthers) && !_vm.deal.isDelete)?_c('v-icon',[_vm._v(\" mdi-chevron-down \")]):_vm._e()],1)],1)]}}]),model:{value:(_vm.menu),callback:function ($$v) {_vm.menu=$$v},expression:\"menu\"}},[_c('v-card',[_c('v-card-title',{staticClass:\"py-1 font-weight-bold\"}),_c('v-card-text',[_c('p',[_vm._v(\"Cambiar Embudo\")]),_c('div',[_c('v-select',{staticClass:\"mb-6\",attrs:{\"items\":_vm.pipelines,\"item-text\":\"name\",\"item-value\":\"id\",\"return-object\":true,\"prepend-icon\":\"mdi-view-column\",\"label\":\"Embudo\",\"outlined\":\"\",\"dense\":\"\",\"hide-details\":\"auto\"},model:{value:(_vm.pipelineSelected),callback:function ($$v) {_vm.pipelineSelected=$$v},expression:\"pipelineSelected\"}}),(_vm.viewStages)?_c('div',[_c('span',[_c('v-icon',{staticClass:\"mr-4\"},[_vm._v(\"mdi-view-carousel-outline\")]),_vm._v(\" Etapa \")],1),_c('div',{staticClass:\"Pipeline py-3 pl-8\"},[_c('div',{staticClass:\"Pipeline__stages open\"},[_c('ul',_vm._l((_vm.pipelineSelected.stages),function(stage,index){return _c('li',{key:index,class:stage.done ? 'active Stage' : 'Stage',on:{\"click\":function($event){return _vm.selectStage(index, stage)}}},[_c('v-tooltip',{attrs:{\"bottom\":\"\"},scopedSlots:_vm._u([{key:\"activator\",fn:function(ref){\n        var on = ref.on;\n        var attrs = ref.attrs;\nreturn [_c('div',_vm._g(_vm._b({staticClass:\"Stage__content\"},'div',attrs,false),on),[_c('div',{staticClass:\"Stage__name\"}),_c('span',{staticClass:\"Stage__separator \"})])]}}],null,true)},[_c('span',{staticClass:\"d-block font-weight-bold\"},[_vm._v(\" \"+_vm._s(stage.name)+\" \")])])],1)}),0)])])]):_vm._e()],1)]),_c('v-divider'),_c('v-card-actions',{staticClass:\"justify-end\"},[_c('v-btn',{staticClass:\"mr-3\",attrs:{\"color\":\"primary\",\"outlined\":\"\",\"small\":\"\"},on:{\"click\":_vm.cancel}},[_vm._v(\" Cancelar \")]),_c('v-btn',{attrs:{\"disabled\":!_vm.viewStages,\"loading\":_vm.isLoading,\"color\":\"secondary\",\"small\":\"\"},on:{\"click\":_vm.outData}},[_vm._v(\" Guardar \")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <v-menu\n    v-model=\"menu\"\n    bottom\n    offset-y\n    max-width=\"300\"\n    nudge-bottom=\"10\"\n    :close-on-content-click=\"false\"\n    :disabled=\"!((canEdit || canEditOthers) && !deal.isDelete)\"\n  >\n    <template v-slot:activator=\"{ on, attrs }\">\n      <span v-bind=\"attrs\" v-on=\"on\">\n        <v-btn\n          outlined\n          :class=\"{\n            normalCursor: !((canEdit || canEditOthers) && !deal.isDelete),\n          }\"\n        >\n          {{ deal.pipeline ? deal.pipeline.name : '' }}\n          <v-icon v-if=\"(canEdit || canEditOthers) && !deal.isDelete\">\n            mdi-chevron-down\n          </v-icon>\n        </v-btn>\n      </span>\n    </template>\n\n    <v-card>\n      <v-card-title class=\"py-1 font-weight-bold\"></v-card-title>\n      <v-card-text>\n        <p>Cambiar Embudo</p>\n        <div>\n          <v-select\n            v-model=\"pipelineSelected\"\n            :items=\"pipelines\"\n            item-text=\"name\"\n            item-value=\"id\"\n            :return-object=\"true\"\n            prepend-icon=\"mdi-view-column\"\n            label=\"Embudo\"\n            class=\"mb-6\"\n            outlined\n            dense\n            hide-details=\"auto\"\n          ></v-select>\n          <div v-if=\"viewStages\">\n            <span>\n              <v-icon class=\"mr-4\">mdi-view-carousel-outline</v-icon>\n              Etapa\n            </span>\n            <div class=\"Pipeline py-3 pl-8\">\n              <div class=\"Pipeline__stages open\">\n                <ul>\n                  <li\n                    v-for=\"(stage, index) in pipelineSelected.stages\"\n                    :key=\"index\"\n                    :class=\"stage.done ? 'active Stage' : 'Stage'\"\n                    @click=\"selectStage(index, stage)\"\n                  >\n                    <v-tooltip bottom>\n                      <template v-slot:activator=\"{ on, attrs }\">\n                        <div class=\"Stage__content\" v-bind=\"attrs\" v-on=\"on\">\n                          <div class=\"Stage__name\"></div>\n                          <span class=\"Stage__separator \"></span>\n                        </div>\n                      </template>\n                      <span class=\"d-block font-weight-bold\">\n                        {{ stage.name }}\n                      </span>\n                    </v-tooltip>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      </v-card-text>\n      <v-divider></v-divider>\n      <v-card-actions class=\"justify-end\">\n        <v-btn color=\"primary\" outlined small @click=\"cancel\" class=\"mr-3\">\n          Cancelar\n        </v-btn>\n        <v-btn\n          :disabled=\"!viewStages\"\n          :loading=\"isLoading\"\n          color=\"secondary\"\n          small\n          @click=\"outData\"\n        >\n          Guardar\n        </v-btn>\n      </v-card-actions>\n    </v-card>\n  </v-menu>\n</template>\n\n<script>\nimport { subject } from '@casl/ability';\nimport ability from '@/services/ability';\nimport { GET_PIPELINES } from '@/graphql/querys/pipelinesQuery';\nimport { UPDATE, UPDATE_OTHERS } from '@/constants/methods';\nimport { PERMISSIONS_DEALS } from '@/constants/permissions';\n\nexport default {\n  name: 'MenuChangePipeline',\n  props: {\n    deal: {\n      type: Object,\n      required: true,\n    },\n    isLoading: {\n      type: Boolean,\n      required: true,\n    },\n    ownerId: {\n      type: String,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      menu: false,\n      pipelineSelected: { id: '', name: '', stages: [] },\n      stageSelected: { id: '' },\n      PERMISSIONS_DEALS,\n      UPDATE,\n      UPDATE_OTHERS,\n    };\n  },\n  watch: {\n    isLoading(value) {\n      if (!value) {\n        this.menu = false;\n      }\n    },\n    menu(value) {\n      if (value) {\n        this.pipelineSelected = JSON.parse(JSON.stringify(this.deal.pipeline));\n      }\n    },\n    pipelineSelected(pipeline) {\n      if (pipeline && this.viewStages) {\n        this.selectStage(0, pipeline.stages[0]);\n      }\n    },\n  },\n  computed: {\n    viewStages() {\n      if (this.pipelineSelected?.id !== this.deal.pipeline?.id) return true;\n      return false;\n    },\n    canEdit() {\n      return ability.can(\n        UPDATE,\n        subject(PERMISSIONS_DEALS, { authorId: this.ownerId || '' }),\n      );\n    },\n    canEditOthers() {\n      if (!this.canEdit) {\n        return (\n          ability.can(UPDATE_OTHERS, PERMISSIONS_DEALS) &&\n          !ability.can(\n            UPDATE_OTHERS,\n            subject(PERMISSIONS_DEALS, {\n              authorId: this.ownerId || '',\n            }),\n          )\n        );\n      }\n      return ability.can(UPDATE_OTHERS, PERMISSIONS_DEALS);\n    },\n  },\n  methods: {\n    outData() {\n      const input = {\n        pipelineId: this.pipelineSelected.id,\n        stageId: this.stageSelected.id,\n      };\n      this.$emit('outData', input);\n    },\n    cancel() {\n      this.menu = false;\n    },\n    selectStage(index, stageSelected) {\n      this.pipelineSelected.stages = this.pipelineSelected.stages.map(\n        (stage, stageIndex) => {\n          // si es menor que el index done es = true\n          stage.done = stageIndex <= index; // eslint-disable-line\n          return stage;\n        },\n      );\n      this.stageSelected = stageSelected;\n    },\n  },\n  apollo: {\n    pipelines: {\n      query: GET_PIPELINES,\n      fetchPolicy: 'no-cache',\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import '{ .pipeline } from ../../../../scss/components/menu.change.pipeline';\n.normalCursor:hover {\n  cursor: default;\n}\n</style>\n","import mod from \"-!../../../node_modules/@vue/cli-plugin-babel/node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/@vue/cli-plugin-babel/node_modules/thread-loader/dist/cjs.js!../../../node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuChangePipeline.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/@vue/cli-plugin-babel/node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/@vue/cli-plugin-babel/node_modules/thread-loader/dist/cjs.js!../../../node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuChangePipeline.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MenuChangePipeline.vue?vue&type=template&id=6e5c3426&scoped=true&\"\nimport script from \"./MenuChangePipeline.vue?vue&type=script&lang=js&\"\nexport * from \"./MenuChangePipeline.vue?vue&type=script&lang=js&\"\nimport style0 from \"./MenuChangePipeline.vue?vue&type=style&index=0&id=6e5c3426&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6e5c3426\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VDivider } from 'vuetify/lib/components/VDivider';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VMenu } from 'vuetify/lib/components/VMenu';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\nimport { VTooltip } from 'vuetify/lib/components/VTooltip';\ninstallComponents(component, {VBtn,VCard,VCardActions,VCardText,VCardTitle,VDivider,VIcon,VMenu,VSelect,VTooltip})\n"],"sourceRoot":""}