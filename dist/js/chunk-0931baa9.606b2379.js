(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0931baa9"],{"1f09":function(e,t,a){},"2e30":function(e,t,a){},3129:function(e,t,a){"use strict";a("1f09");var n=a("c995"),i=a("24b2"),s=a("7560"),r=a("58df"),o=a("80d2");t["a"]=Object(r["a"])(n["a"],i["a"],s["a"]).extend({name:"VSkeletonLoader",props:{boilerplate:Boolean,loading:Boolean,tile:Boolean,transition:String,type:String,types:{type:Object,default:()=>({})}},computed:{attrs(){return this.isLoading?this.boilerplate?{}:{"aria-busy":!0,"aria-live":"polite",role:"alert",...this.$attrs}:this.$attrs},classes(){return{"v-skeleton-loader--boilerplate":this.boilerplate,"v-skeleton-loader--is-loading":this.isLoading,"v-skeleton-loader--tile":this.tile,...this.themeClasses,...this.elevationClasses}},isLoading(){return!("default"in this.$scopedSlots)||this.loading},rootTypes(){return{actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, card-heading","card-avatar":"image, list-item-avatar","card-heading":"heading",chip:"chip","date-picker":"list-item, card-heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",paragraph:"text@3",sentences:"text@2",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"heading, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"table-cell@6","table-cell":"text","table-tfoot":"text@2, avatar@2",text:"text",...this.types}}},methods:{genBone(e,t){return this.$createElement("div",{staticClass:`v-skeleton-loader__${e} v-skeleton-loader__bone`},t)},genBones(e){const[t,a]=e.split("@"),n=()=>this.genStructure(t);return Array.from({length:a}).map(n)},genStructure(e){let t=[];e=e||this.type||"";const a=this.rootTypes[e]||"";if(e===a);else{if(e.indexOf(",")>-1)return this.mapBones(e);if(e.indexOf("@")>-1)return this.genBones(e);a.indexOf(",")>-1?t=this.mapBones(a):a.indexOf("@")>-1?t=this.genBones(a):a&&t.push(this.genStructure(a))}return[this.genBone(e,t)]},genSkeleton(){const e=[];return this.isLoading?e.push(this.genStructure()):e.push(Object(o["t"])(this)),this.transition?this.$createElement("transition",{props:{name:this.transition},on:{afterEnter:this.resetStyles,beforeEnter:this.onBeforeEnter,beforeLeave:this.onBeforeLeave,leaveCancelled:this.resetStyles}},e):e},mapBones(e){return e.replace(/\s/g,"").split(",").map(this.genStructure)},onBeforeEnter(e){this.resetStyles(e),this.isLoading&&(e._initialStyle={display:e.style.display,transition:e.style.transition},e.style.setProperty("transition","none","important"))},onBeforeLeave(e){e.style.setProperty("display","none","important")},resetStyles(e){e._initialStyle&&(e.style.display=e._initialStyle.display||"",e.style.transition=e._initialStyle.transition,delete e._initialStyle)}},render(e){return e("div",{staticClass:"v-skeleton-loader",attrs:this.attrs,on:this.$listeners,class:this.classes,style:this.isLoading?this.measurableStyles:void 0},[this.genSkeleton()])}})},"455a":function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return p})),a.d(t,"c",(function(){return u})),a.d(t,"e",(function(){return m})),a.d(t,"d",(function(){return g}));var n,i,s,r,o,l=a("8785"),d=a("5184"),c=Object(d["a"])(n||(n=Object(l["a"])(["\n  mutation CreatePipeline($input: pipelineCreateInput!) {\n    createPipeline(pipelineInput: $input) {\n      id\n    }\n  }\n"]))),p=Object(d["a"])(i||(i=Object(l["a"])(["\n  mutation DeletePipeline($input: pipelineDeleteInput!) {\n    deletePipeline(pipelineInput: $input) {\n      id\n      name\n    }\n  }\n"]))),u=Object(d["a"])(s||(s=Object(l["a"])(["\n  mutation DeleteStage($input: stageDeleteInput!) {\n    deleteStage(stageInput: $input) {\n      id\n      name\n    }\n  }\n"]))),m=Object(d["a"])(r||(r=Object(l["a"])(["\n  mutation UpdatePipeline($input: pipelineUpdateInput!) {\n    updatePipeline(pipelineInput: $input) {\n      id\n      name\n      stages {\n        id\n        name\n        probability\n        maxDays\n        order\n        deals {\n          id\n          title\n          value\n          status\n        }\n      }\n    }\n  }\n"]))),g=Object(d["a"])(o||(o=Object(l["a"])(["\n  mutation DuplicatePipeline($pipelineId: ID!) {\n    duplicatePipeline(pipelineId: $pipelineId) {\n      id\n      name\n    }\n  }\n"])))},"77cb":function(e,t,a){"use strict";a("2e30")},"93d3":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{fluid:""}},[a("v-row",[a("v-col",{staticClass:"white py-6 pl-12",attrs:{cols:"10"}},[a("v-text-field",{directives:[{name:"show",rawName:"v-show",value:!e.isLoadingPage,expression:"!isLoadingPage"}],staticClass:"input-width-20",attrs:{label:"Nombre de Embudo",outlined:"",maxlength:"30","hide-details":"auto",dense:""},model:{value:e.newPipeline.name,callback:function(t){e.$set(e.newPipeline,"name",t)},expression:"newPipeline.name"}}),a("v-skeleton-loader",{directives:[{name:"show",rawName:"v-show",value:e.isLoadingPage,expression:"isLoadingPage"}],attrs:{type:"button"}})],1),a("v-col",{staticClass:"white",attrs:{cols:"2","align-self":"start",align:"end"}},[a("v-menu",{attrs:{"offset-y":"",ransition:"scale-transition"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("v-btn",e._g({staticClass:"my-4 mr-8  white--text",attrs:{color:"secondary",fab:"",depressed:"",small:""}},n),[a("v-icon",{attrs:{dark:""}},[e._v("mdi-plus")])],1)]}}])},[a("v-list",[a("v-list-item",{attrs:{disabled:e.newPipeline.stages.length>=15},on:{click:e.addStage}},[a("v-icon",{attrs:{left:""}},[e._v("mdi-view-carousel-outline")]),e._v(" "+e._s(e.newPipeline.stages.length>=15?"Limite de etapas superado":"Nueva Etapa")+" ")],1)],1)],1)],1),e.isError?a("v-col",[a("v-card",{attrs:{height:"800"}},[a("BaseErrorComponent",{attrs:{info:e.infoError}})],1)],1):e._e(),e._l(4,(function(t,n){return a("v-col",{directives:[{name:"show",rawName:"v-show",value:e.isLoadingPage,expression:"isLoadingPage"}],key:n},[a("v-skeleton-loader",{attrs:{type:"image"}})],1)}))],2),a("v-card",{staticClass:"mt-12 ml-10 stage-container",attrs:{flat:""}},[a("draggable",{staticClass:"d-flex",attrs:{group:{name:"stages",put:!0},animation:200},on:{change:e.changeOrderStage},model:{value:e.newPipeline.stages,callback:function(t){e.$set(e.newPipeline,"stages",t)},expression:"newPipeline.stages"}},e._l(e.newPipeline.stages,(function(t,n){return a("v-card",{key:n,staticClass:"justify-center flex-column  mx-6 mb-6 stage-edit",attrs:{width:"100%","min-width":"300",height:"90%"}},[a("v-card-title",{staticClass:"stage-header-edit"},[e._v(" "+e._s(t.name)+" ")]),a("v-divider"),a("v-card-text",[a("v-text-field",{staticClass:"my-10",attrs:{label:"Nombre de etapa",outlined:"",maxlength:"25",counter:"25"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"stage.name"}}),a("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:["###%","##.##%"],expression:"['###%', '##.##%']"}],staticClass:"mb-10",attrs:{label:"Probabilidad de cierre %",outlined:"",min:0,max:100},on:{change:function(e){parseInt(t.probability,10)>100?t.probability="100":parseInt(t.probability,10)<0&&(t.probability="0")}},model:{value:t.probability,callback:function(a){e.$set(t,"probability",a)},expression:"stage.probability"}}),a("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"###",expression:"'###'"}],attrs:{min:0,max:365,type:"number",label:"Días de estancamiento",outlined:""},on:{change:function(e){t.maxDays>365?t.maxDays=365:t.maxDays<0&&(t.maxDays=0)}},model:{value:t.maxDays,callback:function(a){e.$set(t,"maxDays",e._n(a))},expression:"stage.maxDays"}})],1),a("v-card-actions",{staticClass:"justify-center stage-actions"},[a("v-btn",{staticClass:"button-delete-stage mb-7",attrs:{disabled:e.newPipeline.stages.length<=2,color:"red",width:"60%",outlined:""},on:{click:function(a){return e.deleteStageConfirmation(n,t)}}},[a("v-icon",[e._v("mdi-delete-outline")])],1)],1)],1)})),1)],1),a("v-col",{attrs:{align:"end"}},[a("v-btn",{staticClass:"mr-8",attrs:{large:"",tile:"",outlined:"",color:"secondary"},on:{click:e.confirmBack}},[e._v(" Cancelar ")]),e.$can(e.CREATE,e.PERMISSIONS_PIPELINES)?a("v-btn",{attrs:{large:"",tile:"",normal:"",color:"secondary",loading:e.isLoading},on:{click:function(t){return e.createPipeline(e.newPipeline)}}},[e._v(" Guardar ")]):e._e()],1),a("BaseModalError",{attrs:{modalHandler:e.modalError},on:{close:e.modalHandlerError}}),a("BaseModalDelete",{attrs:{modalHandler:e.modalDelete},on:{cancel:e.modalHandlerDelete,confirm:e.deleteStage}}),a("BaseModalAlert",{attrs:{modalHandler:e.modalAlert},on:{confirm:e.backPipeline,close:e.modalHandlerAlert}})],1)},i=[],s=a("3835"),r=(a("d3b7"),a("3ca3"),a("ddb0"),a("d81d"),a("b0c0"),a("7db0"),a("a434"),a("b76a")),o=a.n(r),l=a("891c"),d=a("ee2e"),c=a("9500"),p=a("455a"),u=a("1e6d"),m={name:"PipelineCreate",components:{BaseErrorComponent:function(){return a.e("chunk-2d0abe3b").then(a.bind(null,"16cc"))},draggable:o.a},mixins:[u["a"]],data:function(){return{PERMISSIONS_PIPELINES:d["k"],CREATE:l["d"],newPipeline:{stages:[]},isLoading:!1,isLoadingPage:!0,isError:!1,infoError:{icon:"mdi-alert",title:"error",message:"No se ha podido cargar los tratos, contacte con el soporte"}}},watch:{defaultPipelines:function(e){if(e){var t=Object(s["a"])(e,1),a=t[0],n=a.stages.map((function(e){var t=e.name,a=e.probability,n=e.maxDays,i=e.order,s={name:t,probability:a,maxDays:n,order:i};return s}));a.stages=n,this.newPipeline=a,this.isLoadingPage=!1}}},methods:{changeOrderStage:function(e){var t=e.moved,a=t.newIndex,n=t.oldIndex,i=JSON.parse(JSON.stringify(this.newPipeline.stages)),s=i.find((function(e,t){return t===n})),r=i.find((function(e,t){return t===a}));i[n]=s,i[a]=r;var o=i.map((function(e,t){return e.order=t+1,{id:e.id,name:e.name,probability:e.probability,maxDays:e.maxDays,order:e.order}}));this.newPipeline.stages=o},createPipeline:function(e){var t=this,a=e.name,n=e.stages;n=n.map((function(e){return delete e.id,e.maxDays=parseInt(e.maxDays),e})),this.isLoading=!0,this.$apollo.mutate({mutation:p["a"],variables:{input:{name:a,stages:n}}}).then((function(e){var a=e.data.createPipeline.id;t.isLoading=!1,t.$router.push({name:"pipeline-id",params:{id:a}})})).catch((function(e){var a,n=e.graphQLErrors;t.isLoading=!1;var i="Error ".concat(null===(a=n[0])||void 0===a?void 0:a.statusCode," No se ha podido crear el embudo, intente de nuevo");t.modalHandlerError({isOpen:!0,error:i})}))},confirmBack:function(){this.modalHandlerAlert({isOpen:!0,isLoading:!1,message:{text:"Si sale en este momento su configuración se perderá"},info:{}})},backPipeline:function(){window.history.back()},deleteStageConfirmation:function(e,t){this.modalHandlerDelete({isOpen:!0,isLoading:!1,message:{nameItem:"La etapa ".concat(t.name),text:"será eliminada del embudo"},infoDelete:{index:e}})},deleteStage:function(e){var t=e.isOpen,a=e.isLoading,n=e.message,i=e.infoDelete;this.modalHandlerDelete({isOpen:t,isLoading:a,message:n,infoDelete:i}),this.newPipeline.stages.splice(i.index,1),this.reorderStages(),this.modalHandlerDelete({isOpen:!1,isLoading:a,message:n,infoDelete:i})},reorderStages:function(){this.newPipeline.stages=this.newPipeline.stages.map((function(e,t){return e.order=t+1,e}))},addStage:function(){var e={name:"Nueva Etapa",probability:"0",maxDays:0,order:1};this.newPipeline.stages.push(e),this.reorderStages()}},apollo:{defaultPipelines:{query:c["d"],fetchPolicy:"no-cache"}}},g=m,h=(a("77cb"),a("0c7c")),b=a("6544"),v=a.n(b),f=a("8336"),y=a("b0af"),x=a("99d9"),w=a("62ad"),P=a("a523"),S=a("ce7e"),k=a("132d"),L=a("8860"),C=a("da13"),D=a("e449"),E=a("0fd9"),O=a("3129"),_=a("8654"),I=Object(h["a"])(g,n,i,!1,null,"3ebc814e",null);t["default"]=I.exports;v()(I,{VBtn:f["a"],VCard:y["a"],VCardActions:x["a"],VCardText:x["c"],VCardTitle:x["d"],VCol:w["a"],VContainer:P["a"],VDivider:S["a"],VIcon:k["a"],VList:L["a"],VListItem:C["a"],VMenu:D["a"],VRow:E["a"],VSkeletonLoader:O["a"],VTextField:_["a"]})}}]);
//# sourceMappingURL=chunk-0931baa9.606b2379.js.map